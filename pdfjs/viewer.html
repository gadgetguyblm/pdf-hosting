<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>PDF.js Viewer (ESM)</title>
  <link rel="stylesheet" href="viewer.css"/>
  <style>
    html, body { margin: 0; height: 100%; overflow: hidden; }
    #viewerContainer { height: 100%; width: 100%; }
  </style>
</head>
<body>
  <!-- Main PDF viewer container -->
  <div id="viewerContainer">
    <div id="viewer" class="pdfViewer"></div>
  </div>

  <!-- Load viewer logic via ES modules -->
  <script type="module">
    import * as pdfjsLib from '../build/pdf.mjs';
    import * as pdfjsViewer from './viewer.mjs';

    // Point worker to GitHub Pages absolute URL
    pdfjsLib.GlobalWorkerOptions.workerSrc =
      'https://gadgetguyblm.github.io/pdf-hosting/build/pdf.worker.mjs';

    // Get ?file= parameter or default to your Trails Book PDF
    const urlParams = new URLSearchParams(window.location.search);
    const pdfUrl = urlParams.get('file') ||
      'https://gadgetguyblm.github.io/pdf-hosting/2023-Trails-Book-Web-Version-reduced.pdf';

    // Set up viewer
    const container = document.getElementById('viewerContainer');
    const eventBus = new pdfjsViewer.EventBus();
    const linkService = new pdfjsViewer.PDFLinkService({ eventBus });
    const findController = new pdfjsViewer.PDFFindController({ eventBus, linkService });

    const viewer = new pdfjsViewer.PDFViewer({
      container,
      eventBus,
      linkService,
      findController
    });

    linkService.setViewer(viewer);

    // Load the PDF
    const loadingTask = pdfjsLib.getDocument(pdfUrl);
    loadingTask.promise.then(pdfDocument => {
      viewer.setDocument(pdfDocument);
      linkService.setDocument(pdfDocument, null);
    });
  </script>
</body>
</html>
